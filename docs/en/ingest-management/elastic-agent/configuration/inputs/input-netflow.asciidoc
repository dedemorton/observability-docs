:input-type: netflow

[[netflow-input]]
= NetFlow input

++++
<titleabbrev>NetFlow</titleabbrev>
++++

Use the `netflow` input to read NetFlow and IPFIX exported flows
and options records over UDP.

This input supports NetFlow versions 1, 5, 6, 7, 8 and 9, as well as
IPFIX. For NetFlow versions older than 9, fields are mapped automatically
to NetFlow v9.

Example configuration:

****
**Reviewers:** These configs are incorrect. Waiting to fix until I know what is
correct.
****

[source,yaml]
----
inputs:
  - type: netflow
    max_message_size: 10KiB
    host: "0.0.0.0:2055"
    protocols: [ v5, v9, ipfix ]
    expiration_timeout: 30m
    queue_size: 8192
    custom_definitions:
    - path/to/fields.yml
    detect_sequence_reset: true
----

[[input-netflow-configuration-settings]]
== Configuration settings

The `netflow` input supports the following settings. Many of these settings have
sensible defaults that allow you to run {agent} with minimal configuration.

{also-see-common-input-settings}

[[input-netflow-custom_definitions-setting]]
`custom_definitions`::
(list) A list of paths to YAML files containing field definitions. Use these
custom definitions to update the NetFlow/IPFIX fields with vendor extensions and
to override existing fields.
+
The expected format is the same as used by the {ls} NetFlow codec
{logstash-ref}/plugins-codecs-netflow.html#plugins-codecs-netflow-ipfix_definitions[ipfix_definitions]
and
{logstash-ref}/plugins-codecs-netflow.html#plugins-codecs-netflow-netflow_definitions[netflow_definitions].
{agent} detects which of the two formats is used.
+
NetFlow format example:
+
[source,yaml]
----
id:
- default length in bytes
- :name
id:
- :uintN or :intN: or :ip4_addr or :ip6_addr or :mac_addr or :string
- :name
id:
- :skip
----
+
Where `id` is the numeric field ID.
+
The IPFIX format, grouped by Private Enterprise Number (PEN):
+
[source,yaml]
----
pen1:
  id:
  - :uintN or :ip4_addr or :ip6_addr or :mac_addr or :string
  - :name
  id:
  - :skip
pen2:
  id:
  - :octetarray
  - :name
----
+
Note that fields are shared between NetFlow V9 and IPFIX. Changes to
IPFIX PEN zero are equivalent to changes to NetFlow fields.
+
IMPORTANT: Overriding standard field names and/or types might prevent ECS field
mappings from functioning properly.

[[input-netflow-detect_sequence_reset-setting]]
`detect_sequence_reset`::
(boolean) Controls whether {agent} monitors sequence numbers in the Netflow
packets to detect an Exporting Process reset. When this condition is detected,
record templates for the given exporter will be dropped. This will cause flow
loss until the exporter provides new templates. If set to `false`, {agent}
ignores sequence numbers, which can cause some invalid flows if the exporter
process is reset. This setting is only applicable to Netflow V9 and IPFIX.
+
Default: `true`

[[input-netflow-expiration_timeout-setting]]
`expiration_timeout`::
(string) The time before an idle session or unused template is expired. Only
applicable to v9 and IPFIX protocols. A value of zero disables expiration.
+
Default: `????`

****
**Reviewers:** What is the default here ^^? Filebeat docs don't say.
****

[[input-netflow-udp-host-setting]]
`host`::
(string) The host and UDP port to listen on for event streams.

[[input-netflow-internal_networks-setting]]
`internal_networks`::
(list) A list of CIDR ranges describing the IP addresses that you consider
internal. This is used in determining the values of `source.locality`,
`destination.locality`, and `flow.locality`. The values can be either a CIDR
value or one of the named ranges supported by the `network` condition. The
default value is `[private]`, which classifies RFC 1918 (IPv4) and RFC 4193
(IPv6) addresses as internal.

//TODO: Make network condition an active link after the processors PR is merged.
//should say: ...supported by the <<condition-network,`network`>> condition

[[input-netflow-udp-max_message_size-setting]]
`max_message_size`::
(string) The maximum size of the message received over UDP.
+
Default: `10KiB`

[[input-netflow-protocols-setting]]
`protocols`::
(list) List of enabled protocols. Valid values are `v1`, `v5`, `v6`, `v7`,
`v8`, `v9` and `ipfix`.
+
Default: `????`

****
**Reviewers:** What is the default here ^^? Filebeat docs don't say.
****

[[input-netflow-queue_size-setting]]
`queue_size`::
(int) The maximum number of packets that can be queued for processing. Use
this setting to avoid packet loss when dealing with occasional bursts of
traffic.
+
Default: `????`

****
**Reviewers:** What is the default here ^^? Filebeat docs don't say.
****

[[input-netflow-udp-read_buffer-setting]]
`read_buffer`::
(string) The size of the read buffer on the UDP socket.
+
Default: `???`

[[input-netflow-udp-timeout-setting]]
`timeout`::
(string) The read and write timeout for socket operations.
+
Default: `????`

****
**Reviewers:** What is the default here ^^? Filebeat docs don't say.
****
